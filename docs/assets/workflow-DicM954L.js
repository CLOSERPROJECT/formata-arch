import{i as Z,u as De,j as Ye,k as p,l as q,m as ye,o as Le,q as se,t as Je,p as F,v as U,w as Xe,D as Ze,x as _e,y as R,h as E,z as le,b as v,d as I,A as ie,C as _,c as D,E as he,r as B,F as M,G as et,f as P,H as w,a as j,I as tt,J as ee,K as ge,L as oe,M as rt,N,O as st,Q as ot,X as nt,n as re,S as it,T as at,U as lt,V as Ne,g as je,R as $,W as x,Y as ct,Z as dt,_ as ze,$ as pe,a0 as me,a1 as Fe,a2 as vt,a3 as ut,a4 as xe,a5 as Pe,a6 as ft,a7 as ht,a8 as gt,a9 as pt,aa as mt,ab as $t,ac as ae,ad as wt,ae as bt,af as yt,ag as _t,ah as xt,ai as St,aj as Ie,ak as kt,al as At,am as zt,an as Ct,ao as Mt,ap as Bt,aq as Oe,B as Te,ar as He,as as Se,at as Dt,au as Pt,e as Q,av as de,s as Ot,aw as ke}from"./index-C_opiVaH.js";import{c as Tt,a as Ht,d as Vt,v as Et,P as Lt,H as Nt,C as Ve,f as Ae}from"./form.svelte-CX_DG_9m.js";import{a as jt}from"./await-DpwYRefy.js";import{h as Ft}from"./shiki-vdlFYlyk.js";import{g as J,s as It,S as Rt,N as V,O as T,d as Ut,a as qt,b as Gt,c as Wt,C as Kt,e as Qt,f as Yt,i as Jt,h as Xt,B as Zt}from"./single-dropzone-B7DBSONZ.js";import{S as er}from"./select-department-Bs4f9krJ.js";var tr=["forEach","isDisjointFrom","isSubsetOf","isSupersetOf"],rr=["difference","intersection","symmetricDifference","union"],Ee=!1;class fe extends Set{#t=new Map;#e=Z(0);#r=Z(0);#s=De||-1;constructor(e){if(super(),e){for(var t of e)super.add(t);this.#r.v=super.size}Ee||this.#n()}#o(e){return De===this.#s?Z(e):Ye(e)}#n(){Ee=!0;var e=fe.prototype,t=Set.prototype;for(const r of tr)e[r]=function(...o){return p(this.#e),t[r].apply(this,o)};for(const r of rr)e[r]=function(...o){p(this.#e);var i=t[r].apply(this,o);return new fe(i)}}has(e){var t=super.has(e),r=this.#t,o=r.get(e);if(o===void 0){if(!t)return p(this.#e),!1;o=this.#o(!0),r.set(e,o)}return p(o),t}add(e){return super.has(e)||(super.add(e),q(this.#r,super.size),ye(this.#e)),this}delete(e){var t=super.delete(e),r=this.#t,o=r.get(e);return o!==void 0&&(r.delete(e),q(o,!1)),t&&(q(this.#r,super.size),ye(this.#e)),t}clear(){if(super.size!==0){super.clear();var e=this.#t;for(var t of e.values())q(t,!1);e.clear(),q(this.#r,0),ye(this.#e)}}keys(){return this.values()}values(){return p(this.#e),super.values()}entries(){return p(this.#e),super.entries()}[Symbol.iterator](){return this.keys()}get size(){return p(this.#r)}}function*ne({$ref:s,properties:e,dependencies:t,oneOf:r,allOf:o,anyOf:i},l,u=new Set){if(s){if(u.has(s))return;u.add(s);const a=Le(s,l);se(a)&&(yield*ne(a,l,u));return}if(e)for(const a of Object.keys(e))yield a;for(const a of[r,o,i])if(Array.isArray(a))for(const m of a)se(m)&&(yield*ne(m,l,u));if(t!==void 0)for(const a of Object.values(t))!Array.isArray(a)&&se(a)&&(yield*ne(a,l,u))}var sr=P("<button><!></button>");function or(s,e){const t=Je();F(e,!0);let r=U(e,"id",19,()=>Xe(t)),o=U(e,"ref",15,null),i=U(e,"disabled",3,!1),l=w(e,["$$slots","$$events","$$legacy","id","ref","children","child","disabled"]);const u=Ze.create({id:_e(()=>r()),ref:_e(()=>o(),d=>o(d)),disabled:_e(()=>!!i())}),a=M(()=>et(l,u.props));var m=R(),z=E(m);{var b=d=>{var c=R(),n=E(c);ie(n,()=>e.child,()=>({props:p(a)})),v(d,c)},g=d=>{var c=sr();_(c,()=>({...p(a)}));var n=D(c);ie(n,()=>e.children??he),B(c),v(d,c)};le(z,d=>{e.child?d(b):d(g,!1)})}v(s,m),I()}function nr(s,e){F(e,!0);let t=U(e,"ref",15,null),r=w(e,["$$slots","$$events","$$legacy","ref","class"]);var o=R(),i=E(o);{let l=M(()=>ge("text-lg font-semibold leading-none",e.class));j(i,()=>tt,(u,a)=>{a(u,ee({"data-slot":"dialog-title",get class(){return p(l)}},()=>r,{get ref(){return t()},set ref(m){t(m)}}))})}v(s,o),I()}var ir=P("<div><!></div>");function ar(s,e){F(e,!0);let t=U(e,"ref",15,null),r=w(e,["$$slots","$$events","$$legacy","ref","class","children"]);var o=ir();_(o,l=>({"data-slot":"dialog-header",class:l,...r}),[()=>ge("flex flex-col gap-2 text-center sm:text-left",e.class)]);var i=D(o);ie(i,()=>e.children??he),B(o),oe(o,l=>t(l),()=>t()),v(s,o),I()}function lr(s,e){F(e,!0);let t=U(e,"ref",15,null),r=w(e,["$$slots","$$events","$$legacy","ref","class"]);var o=R(),i=E(o);{let l=M(()=>ge("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",e.class));j(i,()=>rt,(u,a)=>{a(u,ee({"data-slot":"dialog-overlay",get class(){return p(l)}},()=>r,{get ref(){return t()},set ref(m){t(m)}}))})}v(s,o),I()}var cr=P('<!> <span class="sr-only">Close</span>',1),dr=P("<!> <!>",1),vr=P("<!> <!>",1);function ur(s,e){F(e,!0);let t=U(e,"ref",15,null),r=U(e,"showCloseButton",3,!0),o=w(e,["$$slots","$$events","$$legacy","ref","class","portalProps","children","showCloseButton"]);var i=R(),l=E(i);j(l,()=>gr,(u,a)=>{a(u,ee(()=>e.portalProps,{children:(m,z)=>{var b=vr(),g=E(b);j(g,()=>lr,(c,n)=>{n(c,{})});var d=N(g,2);{let c=M(()=>ge("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed left-[50%] top-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",e.class));j(d,()=>st,(n,f)=>{f(n,ee({"data-slot":"dialog-content",get class(){return p(c)}},()=>o,{get ref(){return t()},set ref(h){t(h)},children:(h,y)=>{var k=dr(),H=E(k);ie(H,()=>e.children??he);var S=N(H,2);{var A=C=>{var O=R(),L=E(O);j(L,()=>ot,(G,$e)=>{$e(G,{class:"ring-offset-background focus:ring-ring rounded-xs focus:outline-hidden absolute end-4 top-4 opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 disabled:pointer-events-none [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",children:(W,ce)=>{var K=cr(),X=E(K);nt(X,{}),re(2),v(W,K)},$$slots:{default:!0}})}),v(C,O)};le(S,C=>{r()&&C(A)})}v(h,k)},$$slots:{default:!0}}))})}v(m,b)},$$slots:{default:!0}}))}),v(s,i),I()}function fr(s,e){F(e,!0);let t=U(e,"ref",15,null),r=w(e,["$$slots","$$events","$$legacy","ref"]);var o=R(),i=E(o);j(i,()=>or,(l,u)=>{u(l,ee({"data-slot":"dialog-trigger"},()=>r,{get ref(){return t()},set ref(a){t(a)}}))}),v(s,o),I()}const hr=at,gr=it;function pr(s,e){const t=Ce(s,e);return t?.type==="branch"?t.key??e.join(","):null}function Ce(s,e){if(e.length===0)return;let t=s;for(let r=0;r<e.length;r++){const o=e[r];if(o<0||o>=t.length)return;const i=t[o];if(i.type==="leaf")return r===e.length-1?i:void 0;if(r===e.length-1)return i;t=i.children}}function mr(s,e){if(e.length===0)return;if(e.length===1)return s;const t=Ce(s,e.slice(0,-1));if(!(!t||t.type==="leaf"))return t.children}function $r(s,e){return e.length===0?!1:e[e.length-1]>0}function wr(s,e){if(e.length===0)return!1;const t=mr(s,e);return t?e[e.length-1]<t.length-1:!1}class br{constructor(e,t={}){this.getStructure=e,this.options=t}get Tree(){return lt}#t=Z(Ne({state:"idle"}));get selection(){return p(this.#t)}set selection(e){q(this.#t,e,!0)}expanded=new fe;#e=M(()=>this.getStructure());get structure(){return p(this.#e)}set structure(e){q(this.#e,e)}expand(e){const t=pr(this.structure,e);t&&this.expanded.add(t)}canMoveUp(e){return $r(this.structure,e)}canMoveDown(e){return wr(this.structure,e)}select(e,t){this.selection={state:"selected",path:e,type:t},t==="branch"&&this.expand(e)}setAdding(e,t){this.selection={state:"adding",path:e,type:t}}clearSelection(){this.selection={state:"idle"}}getNodeAt(e){return Ce(this.structure,e)}get addTypesByDepth(){return this.options.addTypesByDepth??{}}get maxBranchDepth(){return this.options.maxBranchDepth??1/0}allowedAddTypesAtDepth(e){return this.options.addTypesByDepth?.[e]??[]}showAddBranchAtDepth(e){return e<this.maxBranchDepth&&this.allowedAddTypesAtDepth(e).includes("branch")}showAddLeafAtDepth(e){return this.allowedAddTypesAtDepth(e).includes("leaf")}handleMoveUp(e){if(!this.canMoveUp(e))return;const t=this.selection,r=t.state==="selected"&&e.length===t.path.length&&e.every((o,i)=>o===t.path[i])&&this.getNodeAt(e)?.type===t.type;if(this.options.onMoveUp?.(e),r){const o=e.length-1,i=[...e.slice(0,o),e[o]-1];this.select(i,t.type)}}handleMoveDown(e){if(!this.canMoveDown(e))return;const t=this.selection,r=t.state==="selected"&&e.length===t.path.length&&e.every((o,i)=>o===t.path[i])&&this.getNodeAt(e)?.type===t.type;if(this.options.onMoveDown?.(e),r){const o=e.length-1,i=[...e.slice(0,o),e[o]+1];this.select(i,t.type)}}handleDelete(e){const t=this.getNodeAt(e);t?.type==="branch"&&t.children.length>0&&!window.confirm("Delete this node and all its children? This action cannot be undone.")||this.options.onDelete?.(e)}handleAddBranch(e){this.setAdding(e,"branch"),this.options.onAddBranch?.(e)}handleAddLeaf(e){this.setAdding(e,"leaf"),this.options.onAddLeaf?.(e)}}function Y(s){return{...s,substeps:s.substeps.map((e,t)=>({...e,order:t+1,id:`${s.id}.${t+1}`}))}}function te(s){s.workflow.steps=s.workflow.steps.map((e,t)=>{const r={...e,order:t+1,id:String(t+1)};return Y(r)})}class yr{constructor(e){this.config=e}getEntityName(){return"Step"}getKey(e){return e.id}getSchema(){return je("Step")}list(){return this.config.workflow.steps}getOne(e){const t=this.config.workflow.steps.find(r=>r.id===e);return t!==void 0?$.ok(t):$.err(new Error(`Step not found: ${e}`))}create(e){this.config.workflow.steps=[...this.config.workflow.steps,e],te(this.config);const t=this.config.workflow.steps[this.config.workflow.steps.length-1];return t!==void 0?$.ok(t):$.ok(e)}createAt(e,t){const r=[...this.config.workflow.steps];r.splice(t,0,e),this.config.workflow.steps=r,te(this.config);const o=this.config.workflow.steps[t];return o!==void 0?$.ok(o):$.ok(e)}moveUp(e){if(e<=0)return $.ok(void 0);const t=this.config.workflow.steps,r=t[e],o=t[e-1];return!r||!o?$.ok(void 0):(this.config.workflow.steps=t.map((i,l)=>l===e?o:l===e-1?r:i),te(this.config),$.ok(void 0))}moveDown(e){const t=this.config.workflow.steps;if(e>=t.length-1)return $.ok(void 0);const r=t[e],o=t[e+1];return!r||!o?$.ok(void 0):(this.config.workflow.steps=t.map((i,l)=>l===e?o:l===e+1?r:i),te(this.config),$.ok(void 0))}update(e,t){const r=this.config.workflow.steps.findIndex(i=>i.id===e);if(r===-1)return $.err(new Error(`Step not found: ${e}`));const o=Y({...t,id:String(r+1),order:r+1});return this.config.workflow.steps=this.config.workflow.steps.map(i=>i.id===e?o:i),$.ok(o)}delete(e){return this.config.workflow.steps.findIndex(r=>r.id===e)===-1?$.err(new Error(`Step not found: ${e}`)):(this.config.workflow.steps=this.config.workflow.steps.filter(r=>r.id!==e),te(this.config),$.ok(void 0))}}function _r(s,e){F(e,!0);const t=J();It({isDragged:!1}),Rt(s,{showRequired:!1,get node(){return t.rootNode},set node(r){t.rootNode=r}}),I()}var xr=x('<svg><path fill="currentColor" d="M21 8H3V6h18M9 13h12v-2H9m0 7h12v-2H9"></path></svg>');function Sr(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=xr();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var kr=x('<svg><path fill="currentColor" d="M4 2h16a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H4c-1.08 0-2-.9-2-2V4a2 2 0 0 1 2-2m0 2v7h7V4zm0 16h7v-7H4zm16 0v-7h-7v7zm0-16h-7v7h7z"></path></svg>');function Ar(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=kr();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var zr=x('<svg><path fill="currentColor" d="M7 5h14v2H7zm0 8v-2h14v2zM4 4.5A1.5 1.5 0 0 1 5.5 6A1.5 1.5 0 0 1 4 7.5A1.5 1.5 0 0 1 2.5 6A1.5 1.5 0 0 1 4 4.5m0 6A1.5 1.5 0 0 1 5.5 12A1.5 1.5 0 0 1 4 13.5A1.5 1.5 0 0 1 2.5 12A1.5 1.5 0 0 1 4 10.5M7 19v-2h14v2zm-3-2.5A1.5 1.5 0 0 1 5.5 18A1.5 1.5 0 0 1 4 19.5A1.5 1.5 0 0 1 2.5 18A1.5 1.5 0 0 1 4 16.5"></path></svg>');function Cr(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=zr();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var Mr=x('<svg><path fill="currentColor" d="M12 20a8 8 0 0 1-8-8a8 8 0 0 1 8-8a8 8 0 0 1 8 8a8 8 0 0 1-8 8m0-18A10 10 0 0 0 2 12a10 10 0 0 0 10 10a10 10 0 0 0 10-10A10 10 0 0 0 12 2"></path></svg>');function Br(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=Mr();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var Dr=x('<svg><path fill="currentColor" d="M19 3H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 2v14H5V5z"></path></svg>');function Pr(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=Dr();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var Or=x('<svg><path fill="currentColor" d="M13 19a1 1 0 0 0 1 1h2v2h-2.5c-.55 0-1.5-.45-1.5-1c0 .55-.95 1-1.5 1H8v-2h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1H8V2h2.5c.55 0 1.5.45 1.5 1c0-.55.95-1 1.5-1H16v2h-2a1 1 0 0 0-1 1z"></path></svg>');function Tr(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=Or();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var Hr=x('<svg><path fill="currentColor" d="m5.41 21l.71-4h-4l.35-2h4l1.06-6h-4l.35-2h4l.71-4h2l-.71 4h6l.71-4h2l-.71 4h4l-.35 2h-4l-1.06 6h4l-.35 2h-4l-.71 4h-2l.71-4h-6l-.71 4zM9.53 9l-1.06 6h6l1.06-6z"></path></svg>');function Vr(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=Hr();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var Er=x('<svg><path fill="currentColor" d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3s3-1.34 3-3s-1.34-3-3-3"></path></svg>');function Lr(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=Er();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var Nr=x('<svg><path fill="currentColor" d="M16.5 6v11.5a4 4 0 0 1-4 4a4 4 0 0 1-4-4V5A2.5 2.5 0 0 1 11 2.5A2.5 2.5 0 0 1 13.5 5v10.5a1 1 0 0 1-1 1a1 1 0 0 1-1-1V6H10v9.5a2.5 2.5 0 0 0 2.5 2.5a2.5 2.5 0 0 0 2.5-2.5V5a4 4 0 0 0-4-4a4 4 0 0 0-4 4v12.5a5.5 5.5 0 0 0 5.5 5.5a5.5 5.5 0 0 0 5.5-5.5V6z"></path></svg>');function jr(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=Nr();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var Fr=x('<svg><path fill="currentColor" d="M5.5 7A1.5 1.5 0 0 1 4 5.5A1.5 1.5 0 0 1 5.5 4A1.5 1.5 0 0 1 7 5.5A1.5 1.5 0 0 1 5.5 7m15.91 4.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.11 0-2 .89-2 2v7c0 .55.22 1.05.59 1.41l8.99 9c.37.36.87.59 1.42.59s1.05-.23 1.41-.59l7-7c.37-.36.59-.86.59-1.41c0-.56-.23-1.06-.59-1.42"></path></svg>');function Ir(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=Fr();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var Rr=x('<svg><path fill="currentColor" d="M9 5a7 7 0 0 0-7 7a7 7 0 0 0 7 7c1.04 0 2.06-.24 3-.68c.94.44 1.96.68 3 .68a7 7 0 0 0 7-7a7 7 0 0 0-7-7c-1.04 0-2.06.24-3 .68c-.94-.44-1.96-.68-3-.68m0 2c.34 0 .67.03 1 .1c-1.28 1.31-2 3.07-2 4.9s.72 3.59 2 4.89c-.33.07-.66.11-1 .11a5 5 0 0 1-5-5a5 5 0 0 1 5-5m6 0a5 5 0 0 1 5 5a5 5 0 0 1-5 5c-.34 0-.67-.03-1-.1c1.28-1.31 2-3.07 2-4.9s-.72-3.59-2-4.89c.33-.07.66-.11 1-.11"></path></svg>');function Ur(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=Rr();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var qr=x('<svg><path fill="currentColor" d="M9 5c1.04 0 2.06.24 3 .68c.94-.44 1.96-.68 3-.68a7 7 0 0 1 7 7a7 7 0 0 1-7 7c-1.04 0-2.06-.24-3-.68c-.94.44-1.96.68-3 .68a7 7 0 0 1-7-7a7 7 0 0 1 7-7m-.5 7c0 1.87.79 3.56 2.06 4.75l1-.46c-1.25-1-2.06-2.55-2.06-4.29s.81-3.29 2.06-4.29l-1-.46A6.5 6.5 0 0 0 8.5 12m7 0c0-1.87-.79-3.56-2.06-4.75l-1 .46c1.25 1 2.06 2.55 2.06 4.29s-.81 3.29-2.06 4.29l1 .46A6.5 6.5 0 0 0 15.5 12"></path></svg>');function Gr(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=qr();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var Wr=x('<svg><path fill="currentColor" d="M9 5c1.04 0 2.06.24 3 .68c.94-.44 1.96-.68 3-.68a7 7 0 0 1 7 7a7 7 0 0 1-7 7c-1.04 0-2.06-.24-3-.68c-.94.44-1.96.68-3 .68a7 7 0 0 1-7-7a7 7 0 0 1 7-7m0 7c0 2.22 1.21 4.16 3 5.2c1.79-1.04 3-2.98 3-5.2s-1.21-4.16-3-5.2C10.21 7.84 9 9.78 9 12"></path></svg>');function Kr(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=Wr();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var Qr=x('<svg><path fill="currentColor" d="M9 5a7 7 0 0 0-7 7a7 7 0 0 0 7 7c1.04 0 2.06-.24 3-.68c.94.44 1.96.68 3 .68a7 7 0 0 0 7-7a7 7 0 0 0-7-7c-1.04 0-2.06.24-3 .68c-.94-.44-1.96-.68-3-.68m0 2c.34 0 .67.03 1 .1c-1.28 1.31-2 3.07-2 4.9s.72 3.59 2 4.89c-.33.07-.66.11-1 .11a5 5 0 0 1-5-5a5 5 0 0 1 5-5m6 0a5 5 0 0 1 5 5a5 5 0 0 1-5 5c-.34 0-.67-.03-1-.1c1.28-1.31 2-3.07 2-4.9s-.72-3.59-2-4.89c.33-.07.66-.11 1-.11m-3 1c1.26.95 2 2.43 2 4s-.74 3.05-2 4a5.01 5.01 0 0 1-2-4c0-1.57.74-3.05 2-4"></path></svg>');function Yr(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=Qr();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var Jr=x('<svg><path fill="currentColor" d="M19 10H5V8h14zm0 6H5v-2h14z"></path></svg>');function Xr(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=Jr();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var Zr=x('<svg><path fill="currentColor" d="M3 5h6v6H3zm2 2v2h2V7zm6 0h10v2H11zm0 8h10v2H11zm-6 5l-3.5-3.5l1.41-1.41L5 17.17l4.59-4.58L11 14z"></path></svg>');function es(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=Zr();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var ts=x('<svg><path fill="currentColor" d="M16 16.92c-.33.05-.66.08-1 .08s-.67-.03-1-.08v-3.51l-2.5 2.48c-.5-.39-1-.89-1.39-1.39l2.48-2.5H9.08c-.05-.33-.08-.66-.08-1s.03-.67.08-1h3.51l-2.48-2.5c.19-.25.39-.5.65-.74c.24-.26.49-.46.74-.65L14 8.59V5.08c.33-.05.66-.08 1-.08s.67.03 1 .08v3.51l2.5-2.48c.5.39 1 .89 1.39 1.39L17.41 10h3.51c.05.33.08.66.08 1s-.03.67-.08 1h-3.51l2.48 2.5c-.19.25-.39.5-.65.74c-.24.26-.49.46-.74.65L16 13.41zM5 19a2 2 0 0 1 2-2a2 2 0 0 1 2 2a2 2 0 0 1-2 2a2 2 0 0 1-2-2"></path></svg>');function rs(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=ts();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var ss=x('<svg><path fill="currentColor" d="M9 11h6V8l4 4l-4 4v-3H9v3l-4-4l4-4zm-7 9V4h2v16zm18 0V4h2v16z"></path></svg>');function os(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=ss();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var ns=x('<svg><path fill="currentColor" d="M13 20V4h2.03v16zm-3 0V4h2.03v16zM5 8l4.03 4L5 16v-3H2v-2h3zm15 8l-4-4l4-4v3h3v2h-3z"></path></svg>');function is(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=ns();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var as=x('<svg><path fill="currentColor" d="m18.5 4.14l1 1.72L8.97 12l10.53 6.14l-1 1.72L5 12z"></path></svg>');function ls(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=as();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var cs=x('<svg><path fill="currentColor" d="M18.5 2.27L5 10.14L18.5 18l1-1.73l-10.53-6.13L19.5 4zM5 20v2h15v-2z"></path></svg>');function ds(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=cs();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var vs=x('<svg><path fill="currentColor" d="m5.5 4.14l-1 1.72L15 12L4.5 18.14l1 1.72L19 12z"></path></svg>');function us(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=vs();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var fs=x('<svg><path fill="currentColor" d="M6.5 2.27L20 10.14L6.5 18l-1-1.73l10.53-6.13L5.5 4zM20 20v2H5v-2z"></path></svg>');function hs(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=fs();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var gs=x('<svg><path fill="currentColor" d="M11 3h2v7.27l6.29-3.63l1 1.73L14 12l6.3 3.64l-1 1.73l-6.3-3.65V21h-2v-7.27l-6.31 3.63l-1-1.73L10 12L3.72 8.36l1-1.73L11 10.26z"></path></svg>');function ps(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=gs();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var ms=x('<svg><path fill="currentColor" d="M2 3h6v2H4v14h4v2H2zm5 14v-2h2v2zm4 0v-2h2v2zm4 0v-2h2v2zm7-14v18h-6v-2h4V5h-4V3z"></path></svg>');function $s(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=ms();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var ws=x('<svg><path fill="currentColor" d="M17 13H7v-2h10m2-8H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2"></path></svg>');function bs(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=ws();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var ys=x('<svg><path fill="currentColor" d="M17 13h-4v4h-2v-4H7v-2h4V7h2v4h4m2-8H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2"></path></svg>');function _s(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=ys();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var xs=x('<svg><path fill="currentColor" d="M3 1c-1.11 0-2 .89-2 2v11c0 1.11.89 2 2 2h11c1.11 0 2-.89 2-2V3c0-1.11-.89-2-2-2zm0 2h11v11H3zm15 4v2h2v11H9v-2H7v2c0 1.11.89 2 2 2h11c1.11 0 2-.89 2-2V9c0-1.11-.89-2-2-2z"></path></svg>');function Ss(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=xs();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var ks=x('<svg><path fill="currentColor" d="M22 3H5a2 2 0 0 0-2 2v4h2V5h17v14H5v-4H3v4a2 2 0 0 0 2 2h17a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2M7 15v-2H0v-2h7V9l4 3zm13-2h-7v-2h7zm0-4h-7V7h7zm-3 8h-4v-2h4z"></path></svg>');function As(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=ks();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var zs=x('<svg><path fill="currentColor" d="M3 3h6v4H3zm12 7h6v4h-6zm0 7h6v4h-6zm-2-4H7v5h6v2H5V9h2v2h6z"></path></svg>');function Cs(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=zs();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var Ms=x('<svg><path fill="currentColor" d="M6.45 17.45L1 12l5.45-5.45l1.41 1.41L4.83 11h14.34l-3.03-3.04l1.41-1.41L23 12l-5.45 5.45l-1.41-1.41L19.17 13H4.83l3.03 3.04z"></path></svg>');function Bs(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=Ms();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var Ds=x('<svg><path fill="currentColor" d="m18.5 4l1.16 4.35l-.96.26c-.45-.87-.91-1.74-1.44-2.18C16.73 6 16.11 6 15.5 6H13v10.5c0 .5 0 1 .33 1.25c.34.25 1 .25 1.67.25v1H9v-1c.67 0 1.33 0 1.67-.25c.33-.25.33-.75.33-1.25V6H8.5c-.61 0-1.23 0-1.76.43c-.53.44-.99 1.31-1.44 2.18l-.96-.26L5.5 4z"></path></svg>');function Ps(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=Ds();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var Os=x('<svg><path fill="currentColor" d="M3 11h2v2H3zm8-6h2v4h-2zm-2 6h4v4h-2v-2H9zm6 0h2v2h2v-2h2v2h-2v2h2v4h-2v2h-2v-2h-4v2h-2v-4h4v-2h2v-2h-2zm4 8v-4h-2v4zM15 3h6v6h-6zm2 2v2h2V5zM3 3h6v6H3zm2 2v2h2V5zM3 15h6v6H3zm2 2v2h2v-2z"></path></svg>');function Ts(s,e){const t=w(e,["$$slots","$$events","$$legacy"]);var r=Os();_(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),v(s,r)}var Hs=P('<div><!> <span class="text-sm font-medium text-foreground"> </span></div>');function Vs(s,e){F(e,!0);const r=J().createDraggable({unmount:ct,get node(){return e.createNode()}});var o=Hs(),i=D(o);ie(i,()=>e.icon);var l=N(i,2),u=D(l,!0);B(l),B(o),dt(o,()=>r.attach),ze(()=>{pe(o,1,me(["flex items-center gap-2 p-2 rounded-md cursor-grab border hover:bg-accent",r.isDragged&&"bg-accent"])),Fe(u,e.title)}),v(s,o),I()}var Es=P('<div class="flex flex-col gap-2"></div>');function Ls(s,e){F(e,!0);const t={[V.Object]:Sr,[V.ObjectProperty]:null,[V.ObjectPropertyDependency]:null,[V.Predicate]:null,[V.Operator]:null,[V.Array]:Cr,[V.Grid]:Ar,[V.Enum]:Br,[V.MultiEnum]:Pr,[V.EnumItem]:null,[V.String]:Tr,[V.Number]:Vr,[V.Boolean]:Lr,[V.File]:jr,[V.Tags]:Ir,[V.Range]:Bs,[V.QrCode]:Ts},r={[T.And]:Ur,[T.Or]:Gr,[T.Xor]:Kr,[T.Not]:Yr,[T.Eq]:Xr,[T.In]:es,[T.Format]:Ps,[T.Pattern]:rs,[T.MinLength]:is,[T.MaxLength]:os,[T.Less]:ls,[T.LessOrEq]:ds,[T.Greater]:us,[T.GreaterOrEq]:hs,[T.MultipleOf]:ps,[T.Contains]:$s,[T.MinItems]:bs,[T.MaxItems]:_s,[T.UniqueItems]:Ss,[T.HasProperty]:As,[T.Property]:Cs},o=J(),i=M(()=>{if(o.selectedNode?.type===V.Predicate){const u=Ut(o.affectedNode??o.selectedNode);return qt.filter(a=>u.has(a)).map(a=>({id:`op::${a}`,factory:()=>Wt(a),title:Gt[a],nodeType:V.Operator,operatorType:a}))}return o.availableCustomizableNodeTypes.map(u=>({id:`node::${u}`,factory:()=>Qt(u),title:Kt[u],nodeType:u}))});var l=Es();vt(l,21,()=>p(i),({id:u,factory:a,title:m,nodeType:z,operatorType:b})=>u,(u,a)=>{let m=()=>p(a).factory,z=()=>p(a).title,b=()=>p(a).nodeType,g=()=>p(a).operatorType;Vs(u,{get createNode(){return m()},get title(){return z()},icon:c=>{const n=M(()=>g()?r[g()]:t[b()]);var f=R(),h=E(f);j(h,()=>p(n),(y,k)=>{k(y,{class:"shrink-0"})}),v(c,f)},$$slots:{icon:!0}})}),B(l),v(s,l),I()}function Ns(s,e,t,r){function o(g,d,c){const{properties:n,additionalProperties:f,patternProperties:h,propertyNames:y}=g;function k(S,A,C){const O=b(A,C,c[S]);O!==void 0&&(c[S]=O)}if(n!==void 0)for(const[S,A]of Object.entries(n))k(S,A,d[S]);let H;if(h!==void 0){H=[];const S=Object.entries(h).map(([C,O])=>[new RegExp(C),O]),A=new Set(ne(g,t));for(const[C,O]of Object.entries(d)){if(A.has(C))continue;const L=S.find(G=>G[0].test(C));if(L===void 0){H.push(C);continue}k(C,L[1],O)}}if(f!==void 0&&f!==!1)if(H!==void 0)for(const S of H)k(S,f,d[S]);else{const S=new Set(ne(g,t));for(const[A,C]of Object.entries(d))S.has(A)||k(A,f,C)}if(y!==void 0)for(const[S,A]of Object.entries(d))c[S]=A;return c}function i(g,d,c){const{items:n,additionalItems:f}=g;if(n!==void 0)if(Array.isArray(n))for(let h=0;h<n.length;h++)c.push(b(n[h],d[h]));else for(let h=0;h<d.length;h++)c.push(b(n,d[h]));if(f)for(let h=c.length;h<d.length;h++)c.push(b(f,d[h]));return c}function l(g,d,c){const{if:n,then:f,else:h}=g;if(n===void 0)return c;const k=(se(n)?s.isValid(n,t,d):n)?f:h;return k===void 0?c:b(k,d,c)}function u(g,d,c,n){if(!Array.isArray(g)||ht(s,e,d,t))return n;const f=gt(s,e,t,c,g.map(h=>se(h)?h:h?{}:{not:{}}),0,pt(d));return b(g[f],c,n)}function a(g,d,c){if(!Array.isArray(g))return c;for(let n=0;n<g.length;n++)c=b(g[n],d,c);return c}function m(g,d,c){const{anyOf:n}=g;return Array.isArray(n)?d===void 0||ft(d)&&(Array.isArray(d)?d.length===0:Object.keys(d).length===0)?a(n,d,c):u(n,g,d,c):c}function z(g,d,c){const{dependencies:n}=g;if(n===void 0||!xe(d))return c;for(const[f,h]of Object.entries(n))!(f in d)||Array.isArray(h)||(c=b(h,d,c));return c}function b(g,d,c){if(d===void 0||g===!1)return d;if(g===!0)return c;const{$ref:n}=g;if(n!==void 0)return b(Le(n,t),d,c);c=m(g,d,a(g.allOf,d,u(g.oneOf,g,d,c)));const f=ut(g);if(f==="object"){if(!xe(d))return;c=o(g,d,xe(c)?c:{})}else if(f==="array"){if(!Pe(d))return;c=i(g,d,Pe(c)?c:[])}else c===void 0&&(c=d);return z(g,d,l(g,d,c))}return b(t,r)}function js(s,e){F(e,!0);let t=U(e,"node",15);const r=J(),o=M(()=>r.nodeSchema(t())),i=M(()=>r.nodeUiSchema(t())),l=Tt({...Vt,validator:u=>{const a=Et(u);return{...a,validateFormValue(m,z){const b=Ns(a,u.merger(),u.schema,z);return a.validateFormValue(m,b)}}},get initialValue(){return _t(()=>xt(t().options))},get schema(){return p(o)},get uiSchema(){return p(i)},fieldsValidationMode:bt|yt,fieldsValidationDebounceMs:200});mt(l),$t(()=>{l.fieldsValidation.abort()}),ae(()=>{if(l.fieldsValidation.isProcessed)return;const{value:u}=wt(l);t(t().options=u,!0)}),Ht(s,{}),I()}var Fs=P("<div>Field options will appear here</div>");function Is(s,e){F(e,!0);const t=J(),r=M(()=>t.selectedNode);var o=R(),i=E(o);{var l=m=>{Yt(m,{class:"p-3 border-blue-600",children:(z,b)=>{var g=()=>p(r),d=c=>t.updateSelectedNode(c);js(z,{get node(){return g()},set node(c){d(c)}})},$$slots:{default:!0}})},u=M(()=>p(r)&&Jt(p(r))),a=m=>{var z=Fs();pe(z,1,me(["flex h-full flex-col items-center justify-center","rounded-md bg-gray-100 p-4 text-center text-sm text-muted-foreground"])),v(m,z)};le(i,m=>{p(u)?m(l):m(a,!1)})}v(s,o),I()}var Rs=P('<div class="flex flex-col gap-2"><div><formata-form></formata-form></div></div>',2);function Re(s,e){F(e,!0);let t=U(e,"useBuilderContext",3,!0);const r=M(()=>t()?J().schema:e.schema),o=M(()=>t()?J().uiSchema:e.uiSchema),i=M(()=>p(o)&&!kt(p(o)));let l=Z(void 0);ae(()=>{p(l)&&(p(l).schema=p(r),p(l).uiSchema=p(i)?p(o):void 0,p(l).darkMode=St.isDark,p(l).preventPageReload=!1)});const u=M(()=>JSON.stringify({...p(r),...p(o)}));var a=R(),m=E(a);Ie(m,()=>p(u),z=>{var b=Rs(),g=D(b),d=D(g);oe(d,c=>q(l,c),()=>p(l)),B(g),B(b),ze(()=>pe(g,1,me(["rounded-md border border-(--global-border) p-4",e.class]))),v(z,b)}),v(s,a),I()}const ve=(s,e=he)=>{var t=Us(),r=D(t,!0);B(t),ze(()=>Fe(r,e())),v(s,t)};var Us=P('<p class="mb-2 text-sm font-medium text-muted-foreground"> </p>'),qs=P('<div><div class="sticky top-(--header-height) h-[calc(100vh-var(--header-height))] min-w-[150px] overflow-y-auto"><!> <!></div> <div><!> <!></div> <div class="sticky top-(--header-height) h-[calc(100vh-var(--header-height))] min-w-[200px] overflow-y-auto"><!> <!></div> <div class="overflow-x-hidden"><!> <!></div></div>');function Gs(s,e){F(e,!0),Xt(e.ctx);let t=!1;function r(y){e.initialSchema!==void 0&&!t&&(t=!0,y.loadFromSchema(e.initialSchema,e.initialUiSchema)),e.onInit?.(y)}ae(()=>r(e.ctx));let o=Ne(new Array(3));ae(()=>At(document,"mousedown",({target:y})=>{y instanceof Node&&o.every(k=>k!==y)&&o.some(k=>k?.contains(y))||setTimeout(()=>{e.ctx.clearSelection()})}));var i=qs();pe(i,1,me(["mx-auto grid gap-6","grid-cols-[1fr_3fr_2fr_3fr]"]));var l=D(i),u=D(l);ve(u,()=>"Available fields");var a=N(u,2);Ls(a,{}),B(l),oe(l,y=>o[0]=y,()=>o?.[0]);var m=N(l,2),z=D(m);ve(z,()=>"Form structure");var b=N(z,2);_r(b,{}),B(m),oe(m,y=>o[1]=y,()=>o?.[1]);var g=N(m,2),d=D(g);ve(d,()=>"Field settings");var c=N(d,2);Is(c,{}),B(g),oe(g,y=>o[2]=y,()=>o?.[2]);var n=N(g,2),f=D(n);ve(f,()=>"Form preview");var h=N(f,2);Re(h,{}),B(n),B(i),v(s,i),I()}var Ws=P("<p>Loading...</p>"),Ks=P('<div class="min-h-screen bg-background dark:scheme-dark"><!></div>');function Qs(s,e){F(e,!0);const t=Promise.all([Ft]);zt(s,{delayDuration:0,children:(r,o)=>{var i=Ks(),l=D(i);jt(l,()=>t,u=>{var a=Ws();v(u,a)},(u,a)=>{var m=M(()=>{var[g]=p(a);return{highlighter:g}}),z=M(()=>p(m).highlighter);const b=M(()=>new Zt(p(z)));{let g=M(()=>e.initialData?.schema),d=M(()=>e.initialData?.uiSchema);Gs(u,{get ctx(){return p(b)},get initialSchema(){return p(g)},get initialUiSchema(){return p(d)},get onInit(){return e.onInit}})}}),B(i),v(r,i)},$$slots:{default:!0}}),I()}var Ys=P("<!> Edit",1),Js=P('<!> <!> <div class="absolute bottom-0 flex w-full justify-end border-t bg-background/40 p-2 backdrop-blur-xl"><!></div>',1),Xs=P("<!> <!>",1),Zs=P('<div class="flex items-center gap-1 pl-1 text-sm text-muted-foreground"><!> <span>No properties</span></div>'),eo=P('<div class="flex gap-2"><div class="grow rounded-md border bg-gray-100 p-2 text-sm"><!></div> <div><!></div></div>');function to(s,e){F(e,!0);const t=c=>{var n=R(),f=E(n);j(f,()=>hr,(h,y)=>{y(h,{get open(){return p(a)},set open(k){q(a,k,!0)},children:(k,H)=>{var S=Xs(),A=E(S);{const O=(L,G)=>{Te(L,ee(()=>G?.().props,{variant:"outline",onclick:W=>{W.preventDefault(),q(a,!0)},children:(W,ce)=>{var K=Ys(),X=E(K);Lt(X,{}),re(),v(W,K)},$$slots:{default:!0}}))};j(A,()=>fr,(L,G)=>{G(L,{child:O,$$slots:{child:!0}})})}var C=N(A,2);j(C,()=>ur,(O,L)=>{L(O,{class:"h-[calc(100vh-2rem)] w-[calc(100vw-2rem)] max-w-none! p-4!",style:"--header-height: 7rem",children:(G,$e)=>{var W=Js(),ce=E(W);j(ce,()=>ar,(we,Me)=>{Me(we,{class:"border-b pb-2",children:(be,ao)=>{var Be=R(),qe=E(Be);j(qe,()=>nr,(Ge,We)=>{We(Ge,{children:(Ke,lo)=>{re();var Qe=Oe("Formata Config");v(Ke,Qe)},$$slots:{default:!0}})}),v(be,Be)},$$slots:{default:!0}})});var K=N(ce,2);Qs(K,{get initialData(){return p(u)},onInit:b});var X=N(K,2),Ue=D(X);Te(Ue,{onclick:z,children:(we,Me)=>{re();var be=Oe("Save");v(we,be)},$$slots:{default:!0}}),B(X),v(G,W)},$$slots:{default:!0}})}),v(k,S)},$$slots:{default:!0}})}),v(c,n)};let r=U(e,"value",15);const o=Ct(),i=M(()=>e.config.path),l=M(()=>e.config.path.toSpliced(-1,1,"uiSchema")),u=M(()=>{const c=He(o);console.log(c);const n=Se.get(c,p(i)),f=Se.get(c,p(l));if(!(!n||typeof n!="object"||!("type"in n)))return{schema:n,uiSchema:f}});let a=Z(!1),m;function z(){if(!m||!m.validate())return;const c=He(o);Pt(o,{...typeof c=="object"&&c!==null?c:{},schema:m.schema,uiSchema:m.uiSchema??Se.get(c,p(l))}),r(m.schema),q(a,!1)}function b(c){m=c}const g=M(()=>Dt(o,e.config.path)),d=M(()=>p(u)?.schema&&Object.keys(p(u).schema).length>0);Mt(s,{get errors(){return p(g)},showTitle:!0,useLabel:!0,widgetType:"textWidget",type:"template",get value(){return r()},get config(){return e.config},get uiOption(){return e.uiOption},children:(c,n)=>{var f=eo(),h=D(f),y=D(h);{var k=C=>{Re(C,{useBuilderContext:!1,get schema(){return p(u).schema},get uiSchema(){return p(u).uiSchema},class:"border-none! p-2!"})},H=C=>{var O=Zs(),L=D(O);Bt(L,{size:14}),re(2),B(O),v(C,O)};le(y,C=>{p(u)?.schema&&p(d)?C(k):C(H,!1)})}B(h);var S=N(h,2),A=D(S);t(A),B(S),B(f),v(c,f)},$$slots:{default:!0}}),I()}function ue(s){const e=s.indexOf(".");return e===-1?{stepId:s,substepId:""}:{stepId:s.slice(0,e),substepId:s}}class ro{constructor(e){this.config=e}getEntityName(){return"Substep"}getKey(e){return e.id}getSchema(){return je("Substep")}getUiSchema(){return{role:{"ui:components":{textWidget:er},"ui:options":{attestaConfig:this.config}},uiSchema:{"ui:components":{objectTemplate:Nt}},schema:{"ui:components":{objectField:to}}}}list(){return this.config.workflow.steps.flatMap(e=>e.substeps.map(t=>({...t,id:t.id})))}getOne(e){const{stepId:t,substepId:r}=ue(e),o=this.config.workflow.steps.find(l=>l.id===t);if(!o)return $.err(new Error(`Substep not found: ${e}`));const i=o.substeps.find(l=>l.id===r);return i?$.ok({...i,id:r||e}):$.err(new Error(`Substep not found: ${e}`))}create(e){const{stepId:t}=ue(e.id);if(!t)return $.err(new Error("Substep id must be stepId or stepId.substepId"));const r=this.config.workflow.steps.find(l=>l.id===t);if(!r)return $.err(new Error(`Step not found: ${t}`));const o={...e,id:"",order:r.substeps.length+1};r.substeps=Y({...r,substeps:[...r.substeps,o]}).substeps;const i=r.substeps[r.substeps.length-1];return i!==void 0?$.ok(i):$.ok(e)}update(e,t){const{stepId:r,substepId:o}=ue(e),i=this.config.workflow.steps.find(m=>m.id===r);if(!i)return $.err(new Error(`Substep not found: ${e}`));const l=i.substeps.findIndex(m=>m.id===o);if(l===-1)return $.err(new Error(`Substep not found: ${e}`));const u={...t,id:o};i.substeps=Y({...i,substeps:i.substeps.map(m=>m.id===o?u:m)}).substeps;const a=i.substeps[l];return a!==void 0?$.ok(a):$.ok({...t,id:e})}delete(e){const{stepId:t,substepId:r}=ue(e),o=this.config.workflow.steps.find(l=>l.id===t);return o?o.substeps.findIndex(l=>l.id===r)===-1?$.err(new Error(`Substep not found: ${e}`)):(o.substeps=Y({...o,substeps:o.substeps.filter(l=>l.id!==r)}).substeps,$.ok(void 0)):$.err(new Error(`Substep not found: ${e}`))}moveUp(e,t){if(t<=0)return $.ok(void 0);const r=this.config.workflow.steps.find(u=>u.id===e);if(!r)return $.err(new Error(`Step not found: ${e}`));const o=r.substeps;if(t>=o.length)return $.ok(void 0);const i=o[t],l=o[t-1];return!i||!l?$.ok(void 0):(r.substeps=Y({...r,substeps:o.map((u,a)=>a===t?l:a===t-1?i:u)}).substeps,$.ok(void 0))}moveDown(e,t){const r=this.config.workflow.steps.find(u=>u.id===e);if(!r)return $.err(new Error(`Step not found: ${e}`));const o=r.substeps;if(t>=o.length-1)return $.ok(void 0);const i=o[t],l=o[t+1];return!i||!l?$.ok(void 0):(r.substeps=Y({...r,substeps:o.map((u,a)=>a===t?l:a===t+1?i:u)}).substeps,$.ok(void 0))}}var so=P("<div><!></div>"),oo=P("<div><!></div>"),no=P('<div><p class="flex items-center justify-center text-sm text-muted-foreground">Select a step or substep in the tree, or use the add buttons to create one.</p></div>'),io=P('<div class="flex grow justify-stretch"><div class="w-[400px] shrink-0 overflow-auto border-r p-2"><p class="flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 ring-sidebar-ring outline-hidden transition-[margin,opacity] duration-200 ease-linear group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0 focus-visible:ring-2 [&amp;>svg]:size-4 [&amp;>svg]:shrink-0">Steps</p> <!></div> <div class="min-w-0 grow p-4"><!></div></div>');function po(s,e){F(e,!0);function t(n){return n.workflow.steps.map(f=>({type:"branch",label:f.title,key:f.id,children:f.substeps.map(h=>({type:"leaf",label:h.title,key:h.id}))}))}const r=new yr(Q),o=new Ve(r,{form:{hide:{id:!0,order:!0,substeps:!0}}}),i=new ro(Q),l=new Ve(i,{form:{hide:{id:!0,order:!0,inputType:!0}}});function u(n,f){const h=String(n?f:f+1),y=String(n?f+1:f+2),k=a.expanded.has(h),H=a.expanded.has(y);a.expanded.delete(h),a.expanded.delete(y),k&&a.expanded.add(y),H&&a.expanded.add(h)}const a=new br(()=>t(Q),{maxBranchDepth:1,addTypesByDepth:{0:["branch"],1:["leaf"]},onMoveUp(n){if(n.length===1)r.moveUp(n[0]),u(!0,n[0]);else if(n.length===2){const f=Q.workflow.steps[n[0]];f&&i.moveUp(f.id,n[1])}},onMoveDown(n){if(n.length===1)r.moveDown(n[0]),u(!1,n[0]);else if(n.length===2){const f=Q.workflow.steps[n[0]];f&&i.moveDown(f.id,n[1])}},onDelete(n){if(n.length===1){const f=Q.workflow.steps[n[0]];f&&o.openDelete(f)}else if(n.length===2){const f=Q.workflow.steps[n[0]],h=f?.substeps[n[1]];f&&h&&l.openDelete(h)}},onAddBranch(n){a.expand(n)},onAddLeaf(n){a.expand(n)}});ae(()=>{const n=a.selection,f=Q.workflow.steps;if(n.state==="selected"){if(n.path.length===1){const h=f[n.path[0]];h&&o.openEdit(h)}else if(n.path.length===2){const h=f[n.path[0]],y=h?.substeps[n.path[1]];h&&y&&l.openEdit(y)}}else if(n.state==="adding")if(n.type==="branch"){const h=n.path.length===1&&n.path[0]===-1?f.length:n.path.length>0?n.path[0]+1:0,y={id:crypto.randomUUID(),title:"New step",order:h,substeps:[]};o.openCreateWithCallback(y,k=>{const H=r.createAt(k,h);H.isOk?(de.success("Record created"),o.isFormOpen=!1,a.clearSelection()):de.error(H.error.message)})}else{const h=f[n.path[0]];if(!h)return;const y={id:h.id,title:"New substep",order:h.substeps.length+1,role:"",inputKey:"",inputType:"formata"};l.openCreateWithCallback(y,k=>{const H=i.create(k);H.isOk?(de.success("Record created"),l.isFormOpen=!1,a.clearSelection()):de.error(H.error.message)})}}),Ot({title:"Stream / Workflow"});const m=M(()=>{const n=a.selection;return n.state==="idle"?null:n.state==="selected"?n.path.length===1?"step":"substep":n.type==="branch"?"step":"substep"});var z=io(),b=D(z),g=N(D(b),2);j(g,()=>a.Tree,(n,f)=>{f(n,{get self(){return a},showIndices:!0})}),B(b);var d=N(b,2),c=D(d);Ie(c,()=>a.selection,n=>{var f=R(),h=E(f);{var y=S=>{var A=so(),C=D(A);j(C,()=>o.Forms,(O,L)=>{L(O,{get self(){return o},formTitle:"step",onConfirmDelete:()=>a.clearSelection(),onCancel:()=>{a.clearSelection()},hideSubmitButton:!0})}),B(A),ke(3,A,()=>Ae),v(S,A)},k=S=>{var A=oo(),C=D(A);j(C,()=>l.Forms,(O,L)=>{L(O,{get self(){return l},formTitle:"substep",onConfirmDelete:()=>a.clearSelection(),onCancel:()=>{a.clearSelection()},hideSubmitButton:!0})}),B(A),ke(3,A,()=>Ae),v(S,A)},H=S=>{var A=no();ke(3,A,()=>Ae),v(S,A)};le(h,S=>{p(m)==="step"?S(y):p(m)==="substep"?S(k,1):S(H,!1)})}v(n,f)}),B(d),B(z),v(s,z),I()}export{po as default};
