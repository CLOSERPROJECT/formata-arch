import{i as ne,j as Ke,k as Ye,l as ze,H as Je,m as Qe,o as Xe,q as fe,r as Ze,t as et,u as he,v as tt,w as rt,x as ot,y as st,z as Me,U as nt,A as at,C as Pe,D as Z,E as it,p as N,F,G as lt,I as ct,J as ue,c as j,f as V,K as le,b as f,d as L,L as re,M as p,N as y,O,Q as be,S as B,T as k,V as dt,h as P,W as $,a as E,X as vt,Y as J,Z as ce,_ as ee,$ as ft,a0 as R,a1 as ht,a2 as ut,a3 as gt,n as ie,a4 as pt,a5 as mt,a6 as $t,a7 as xe,a8 as Ve,a9 as Y,g as Ee,R as _,aa as b,ab as wt,ac as _t,ad as Ne,ae as Se,af as Ae,ag as Le,ah as yt,ai as bt,aj as ge,ak as De,al as xt,am as St,an as At,ao as kt,ap as Ct,aq as zt,ar as Mt,as as Dt,at as Bt,au as Tt,av as oe,aw as Ht,ax as Ot,ay as Ie,az as Pt,aA as Vt,aB as Et,aC as Nt,aD as pe,B as Be,aE as Te,aF as me,aG as Lt,e as q,aH as ae,s as It,aI as $e}from"./index-DJjTieaz.js";import{c as jt,d as Rt,v as Ft,a as Ut,C as He,f as we}from"./form.svelte-CEB_f0Ju.js";import{g as Q,s as qt,S as Gt,N as H,O as z,d as Wt,a as Kt,b as Yt,c as Jt,C as Qt,e as Xt,f as Zt,i as er,h as tr,j as rr,B as or}from"./single-dropzone-DQKvsb-y.js";import{S as sr}from"./select-department-CqE_-FQ0.js";const Oe=0,_e=1;function nr(s,e,t,r,n){ne&&Ke();var l=nt,a=Me(l),d=Me(l),c=new Ze(s);Ye(()=>{var g=e(),x=!1;let w=ne&&ze(g)===(s.data===Je);if(w&&(Qe(Xe()),fe(!1)),ze(g)){var h=at(),v=!1;const o=i=>{if(!x){v=!0,h(!1),tt.ensure(),ne&&fe(!1);try{i()}finally{rt(),ot||st()}}};g.then(i=>{o(()=>{he(a,i),c.ensure(_e,r&&(u=>r(u,a)))})},i=>{o(()=>{if(he(d,i),c.ensure(_e,n&&(u=>n(u,d))),!n)throw d.v})}),ne?c.ensure(Oe,t):et(()=>{v||o(()=>{c.ensure(Oe,t)})})}else he(a,g),c.ensure(_e,r&&(o=>r(o,a)));return w&&fe(!0),()=>{x=!0}})}function*te({$ref:s,properties:e,dependencies:t,oneOf:r,allOf:n,anyOf:l},a,d=new Set){if(s){if(d.has(s))return;d.add(s);const c=Pe(s,a);Z(c)&&(yield*te(c,a,d));return}if(e)for(const c of Object.keys(e))yield c;for(const c of[r,n,l])if(Array.isArray(c))for(const g of c)Z(g)&&(yield*te(g,a,d));if(t!==void 0)for(const c of Object.values(t))!Array.isArray(c)&&Z(c)&&(yield*te(c,a,d))}var ar=P("<button><!></button>");function ir(s,e){const t=it();N(e,!0);let r=F(e,"id",19,()=>lt(t)),n=F(e,"ref",15,null),l=F(e,"disabled",3,!1),a=$(e,["$$slots","$$events","$$legacy","id","ref","children","child","disabled"]);const d=ct.create({id:ue(()=>r()),ref:ue(()=>n(),v=>n(v)),disabled:ue(()=>!!l())}),c=k(()=>dt(a,d.props));var g=j(),x=V(g);{var w=v=>{var o=j(),i=V(o);re(i,()=>e.child,()=>({props:p(c)})),f(v,o)},h=v=>{var o=ar();y(o,()=>({...p(c)}));var i=O(o);re(i,()=>e.children??be),B(o),f(v,o)};le(x,v=>{e.child?v(w):v(h,!1)})}f(s,g),L()}function lr(s,e){N(e,!0);let t=F(e,"ref",15,null),r=$(e,["$$slots","$$events","$$legacy","ref","class"]);var n=j(),l=V(n);{let a=k(()=>ce("text-lg font-semibold leading-none",e.class));E(l,()=>vt,(d,c)=>{c(d,J({"data-slot":"dialog-title",get class(){return p(a)}},()=>r,{get ref(){return t()},set ref(g){t(g)}}))})}f(s,n),L()}var cr=P("<div><!></div>");function dr(s,e){N(e,!0);let t=F(e,"ref",15,null),r=$(e,["$$slots","$$events","$$legacy","ref","class","children"]);var n=cr();y(n,a=>({"data-slot":"dialog-header",class:a,...r}),[()=>ce("flex flex-col gap-2 text-center sm:text-left",e.class)]);var l=O(n);re(l,()=>e.children??be),B(n),ee(n,a=>t(a),()=>t()),f(s,n),L()}function vr(s,e){N(e,!0);let t=F(e,"ref",15,null),r=$(e,["$$slots","$$events","$$legacy","ref","class"]);var n=j(),l=V(n);{let a=k(()=>ce("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",e.class));E(l,()=>ft,(d,c)=>{c(d,J({"data-slot":"dialog-overlay",get class(){return p(a)}},()=>r,{get ref(){return t()},set ref(g){t(g)}}))})}f(s,n),L()}var fr=P('<!> <span class="sr-only">Close</span>',1),hr=P("<!> <!>",1),ur=P("<!> <!>",1);function gr(s,e){N(e,!0);let t=F(e,"ref",15,null),r=F(e,"showCloseButton",3,!0),n=$(e,["$$slots","$$events","$$legacy","ref","class","portalProps","children","showCloseButton"]);var l=j(),a=V(l);E(a,()=>$r,(d,c)=>{c(d,J(()=>e.portalProps,{children:(g,x)=>{var w=ur(),h=V(w);E(h,()=>vr,(o,i)=>{i(o,{})});var v=R(h,2);{let o=k(()=>ce("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed left-[50%] top-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",e.class));E(v,()=>ht,(i,u)=>{u(i,J({"data-slot":"dialog-content",get class(){return p(o)}},()=>n,{get ref(){return t()},set ref(m){t(m)},children:(m,I)=>{var C=hr(),M=V(C);re(M,()=>e.children??be);var S=R(M,2);{var D=A=>{var T=j(),W=V(T);E(W,()=>ut,(U,X)=>{X(U,{class:"ring-offset-background focus:ring-ring rounded-xs focus:outline-hidden absolute end-4 top-4 opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 disabled:pointer-events-none [&_svg:not([class*='size-'])]:size-4 [&_svg]:pointer-events-none [&_svg]:shrink-0",children:(K,de)=>{var se=fr(),G=V(se);gt(G,{}),ie(2),f(K,se)},$$slots:{default:!0}})}),f(A,T)};le(S,A=>{r()&&A(D)})}f(m,C)},$$slots:{default:!0}}))})}f(g,w)},$$slots:{default:!0}}))}),f(s,l),L()}function pr(s,e){N(e,!0);let t=F(e,"ref",15,null),r=$(e,["$$slots","$$events","$$legacy","ref"]);var n=j(),l=V(n);E(l,()=>ir,(a,d)=>{d(a,J({"data-slot":"dialog-trigger"},()=>r,{get ref(){return t()},set ref(c){t(c)}}))}),f(s,n),L()}const mr=mt,$r=pt;function je(s,e){if(e.length===0)return;let t=s;for(let r=0;r<e.length;r++){const n=e[r];if(n<0||n>=t.length)return;const l=t[n];if(l.type==="leaf")return r===e.length-1?l:void 0;if(r===e.length-1)return l;t=l.children}}function wr(s,e){if(e.length===0)return;if(e.length===1)return s;const t=je(s,e.slice(0,-1));if(!(!t||t.type==="leaf"))return t.children}function _r(s,e){return e.length===0?!1:e[e.length-1]>0}function yr(s,e){if(e.length===0)return!1;const t=wr(s,e);return t?e[e.length-1]<t.length-1:!1}class br{constructor(e,t={}){this.getStructure=e,this.options=t}get Tree(){return $t}#e=xe(Ve({state:"idle"}));get selection(){return p(this.#e)}set selection(e){Y(this.#e,e,!0)}#t=k(()=>this.getStructure());get structure(){return p(this.#t)}set structure(e){Y(this.#t,e)}canMoveUp(e){return _r(this.structure,e)}canMoveDown(e){return yr(this.structure,e)}select(e,t){this.selection={state:"selected",path:e,type:t}}setAdding(e,t){this.selection={state:"adding",path:e,type:t}}clearSelection(){this.selection={state:"idle"}}getNodeAt(e){return je(this.structure,e)}get addTypesByDepth(){return this.options.addTypesByDepth??{}}get maxBranchDepth(){return this.options.maxBranchDepth??1/0}allowedAddTypesAtDepth(e){return this.options.addTypesByDepth?.[e]??[]}showAddBranchAtDepth(e){return e<this.maxBranchDepth&&this.allowedAddTypesAtDepth(e).includes("branch")}showAddLeafAtDepth(e){return this.allowedAddTypesAtDepth(e).includes("leaf")}handleMoveUp(e){if(!this.canMoveUp(e))return;const t=this.selection,r=t.state==="selected"&&e.length===t.path.length&&e.every((n,l)=>n===t.path[l])&&this.getNodeAt(e)?.type===t.type;if(this.options.onMoveUp?.(e),r){const n=e.length-1,l=[...e.slice(0,n),e[n]-1];this.select(l,t.type)}}handleMoveDown(e){if(!this.canMoveDown(e))return;const t=this.selection,r=t.state==="selected"&&e.length===t.path.length&&e.every((n,l)=>n===t.path[l])&&this.getNodeAt(e)?.type===t.type;if(this.options.onMoveDown?.(e),r){const n=e.length-1,l=[...e.slice(0,n),e[n]+1];this.select(l,t.type)}}handleDelete(e){const t=this.getNodeAt(e);t?.type==="branch"&&t.children.length>0&&!window.confirm("Delete this node and all its children? This action cannot be undone.")||this.options.onDelete?.(e)}handleAddBranch(e){this.setAdding(e,"branch"),this.options.onAddBranch?.(e)}handleAddLeaf(e){this.setAdding(e,"leaf"),this.options.onAddLeaf?.(e)}}function Re(s,e){}class xr{constructor(e){this.config=e}getEntityName(){return"Step"}getKey(e){return e.id}getSchema(){return Ee("Step")}getUiSchema(){return{substeps:{"ui:components":{arrayTemplate:Re}}}}list(){return this.config.workflow.steps}getOne(e){const t=this.config.workflow.steps.find(r=>r.id===e);return t!==void 0?_.ok(t):_.err(new Error(`Step not found: ${e}`))}create(e){return this.config.workflow.steps.some(t=>t.id===e.id)?_.err(new Error(`Step already exists: ${e.id}`)):(this.config.workflow.steps=[...this.config.workflow.steps,e],_.ok(e))}createAt(e,t){if(this.config.workflow.steps.some(l=>l.id===e.id))return _.err(new Error(`Step already exists: ${e.id}`));const r=[...this.config.workflow.steps],n={...e,order:t};return r.splice(t,0,n),this.config.workflow.steps=r,_.ok(n)}moveUp(e){if(e<=0)return _.ok(void 0);const t=this.config.workflow.steps,r=t[e],n=t[e-1];return!r||!n?_.ok(void 0):(this.config.workflow.steps=t.map((l,a)=>a===e?{...n,order:e}:a===e-1?{...r,order:e-1}:l),_.ok(void 0))}moveDown(e){const t=this.config.workflow.steps;if(e>=t.length-1)return _.ok(void 0);const r=t[e],n=t[e+1];return!r||!n?_.ok(void 0):(this.config.workflow.steps=t.map((l,a)=>a===e?{...n,order:e}:a===e+1?{...r,order:e+1}:l),_.ok(void 0))}update(e,t){return this.config.workflow.steps.findIndex(n=>n.id===e)===-1?_.err(new Error(`Step not found: ${e}`)):(this.config.workflow.steps=this.config.workflow.steps.map(n=>n.id===e?t:n),_.ok(t))}delete(e){return this.config.workflow.steps.findIndex(r=>r.id===e)===-1?_.err(new Error(`Step not found: ${e}`)):(this.config.workflow.steps=this.config.workflow.steps.filter(r=>r.id!==e),_.ok(void 0))}}function Sr(s,e){N(e,!0);const t=Q();qt({isDragged:!1}),Gt(s,{showRequired:!1,get node(){return t.rootNode},set node(r){t.rootNode=r}}),L()}var Ar=b('<svg><path fill="currentColor" d="M21 8H3V6h18M9 13h12v-2H9m0 7h12v-2H9"></path></svg>');function kr(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=Ar();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var Cr=b('<svg><path fill="currentColor" d="M4 2h16a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H4c-1.08 0-2-.9-2-2V4a2 2 0 0 1 2-2m0 2v7h7V4zm0 16h7v-7H4zm16 0v-7h-7v7zm0-16h-7v7h7z"></path></svg>');function zr(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=Cr();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var Mr=b('<svg><path fill="currentColor" d="M7 5h14v2H7zm0 8v-2h14v2zM4 4.5A1.5 1.5 0 0 1 5.5 6A1.5 1.5 0 0 1 4 7.5A1.5 1.5 0 0 1 2.5 6A1.5 1.5 0 0 1 4 4.5m0 6A1.5 1.5 0 0 1 5.5 12A1.5 1.5 0 0 1 4 13.5A1.5 1.5 0 0 1 2.5 12A1.5 1.5 0 0 1 4 10.5M7 19v-2h14v2zm-3-2.5A1.5 1.5 0 0 1 5.5 18A1.5 1.5 0 0 1 4 19.5A1.5 1.5 0 0 1 2.5 18A1.5 1.5 0 0 1 4 16.5"></path></svg>');function Dr(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=Mr();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var Br=b('<svg><path fill="currentColor" d="M12 20a8 8 0 0 1-8-8a8 8 0 0 1 8-8a8 8 0 0 1 8 8a8 8 0 0 1-8 8m0-18A10 10 0 0 0 2 12a10 10 0 0 0 10 10a10 10 0 0 0 10-10A10 10 0 0 0 12 2"></path></svg>');function Tr(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=Br();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var Hr=b('<svg><path fill="currentColor" d="M19 3H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m0 2v14H5V5z"></path></svg>');function Or(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=Hr();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var Pr=b('<svg><path fill="currentColor" d="M13 19a1 1 0 0 0 1 1h2v2h-2.5c-.55 0-1.5-.45-1.5-1c0 .55-.95 1-1.5 1H8v-2h2a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1H8V2h2.5c.55 0 1.5.45 1.5 1c0-.55.95-1 1.5-1H16v2h-2a1 1 0 0 0-1 1z"></path></svg>');function Vr(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=Pr();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var Er=b('<svg><path fill="currentColor" d="m5.41 21l.71-4h-4l.35-2h4l1.06-6h-4l.35-2h4l.71-4h2l-.71 4h6l.71-4h2l-.71 4h4l-.35 2h-4l-1.06 6h4l-.35 2h-4l-.71 4h-2l.71-4h-6l-.71 4zM9.53 9l-1.06 6h6l1.06-6z"></path></svg>');function Nr(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=Er();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var Lr=b('<svg><path fill="currentColor" d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3s3-1.34 3-3s-1.34-3-3-3"></path></svg>');function Ir(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=Lr();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var jr=b('<svg><path fill="currentColor" d="M16.5 6v11.5a4 4 0 0 1-4 4a4 4 0 0 1-4-4V5A2.5 2.5 0 0 1 11 2.5A2.5 2.5 0 0 1 13.5 5v10.5a1 1 0 0 1-1 1a1 1 0 0 1-1-1V6H10v9.5a2.5 2.5 0 0 0 2.5 2.5a2.5 2.5 0 0 0 2.5-2.5V5a4 4 0 0 0-4-4a4 4 0 0 0-4 4v12.5a5.5 5.5 0 0 0 5.5 5.5a5.5 5.5 0 0 0 5.5-5.5V6z"></path></svg>');function Rr(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=jr();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var Fr=b('<svg><path fill="currentColor" d="M5.5 7A1.5 1.5 0 0 1 4 5.5A1.5 1.5 0 0 1 5.5 4A1.5 1.5 0 0 1 7 5.5A1.5 1.5 0 0 1 5.5 7m15.91 4.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.11 0-2 .89-2 2v7c0 .55.22 1.05.59 1.41l8.99 9c.37.36.87.59 1.42.59s1.05-.23 1.41-.59l7-7c.37-.36.59-.86.59-1.41c0-.56-.23-1.06-.59-1.42"></path></svg>');function Ur(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=Fr();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var qr=b('<svg><path fill="currentColor" d="M9 5a7 7 0 0 0-7 7a7 7 0 0 0 7 7c1.04 0 2.06-.24 3-.68c.94.44 1.96.68 3 .68a7 7 0 0 0 7-7a7 7 0 0 0-7-7c-1.04 0-2.06.24-3 .68c-.94-.44-1.96-.68-3-.68m0 2c.34 0 .67.03 1 .1c-1.28 1.31-2 3.07-2 4.9s.72 3.59 2 4.89c-.33.07-.66.11-1 .11a5 5 0 0 1-5-5a5 5 0 0 1 5-5m6 0a5 5 0 0 1 5 5a5 5 0 0 1-5 5c-.34 0-.67-.03-1-.1c1.28-1.31 2-3.07 2-4.9s-.72-3.59-2-4.89c.33-.07.66-.11 1-.11"></path></svg>');function Gr(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=qr();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var Wr=b('<svg><path fill="currentColor" d="M9 5c1.04 0 2.06.24 3 .68c.94-.44 1.96-.68 3-.68a7 7 0 0 1 7 7a7 7 0 0 1-7 7c-1.04 0-2.06-.24-3-.68c-.94.44-1.96.68-3 .68a7 7 0 0 1-7-7a7 7 0 0 1 7-7m-.5 7c0 1.87.79 3.56 2.06 4.75l1-.46c-1.25-1-2.06-2.55-2.06-4.29s.81-3.29 2.06-4.29l-1-.46A6.5 6.5 0 0 0 8.5 12m7 0c0-1.87-.79-3.56-2.06-4.75l-1 .46c1.25 1 2.06 2.55 2.06 4.29s-.81 3.29-2.06 4.29l1 .46A6.5 6.5 0 0 0 15.5 12"></path></svg>');function Kr(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=Wr();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var Yr=b('<svg><path fill="currentColor" d="M9 5c1.04 0 2.06.24 3 .68c.94-.44 1.96-.68 3-.68a7 7 0 0 1 7 7a7 7 0 0 1-7 7c-1.04 0-2.06-.24-3-.68c-.94.44-1.96.68-3 .68a7 7 0 0 1-7-7a7 7 0 0 1 7-7m0 7c0 2.22 1.21 4.16 3 5.2c1.79-1.04 3-2.98 3-5.2s-1.21-4.16-3-5.2C10.21 7.84 9 9.78 9 12"></path></svg>');function Jr(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=Yr();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var Qr=b('<svg><path fill="currentColor" d="M9 5a7 7 0 0 0-7 7a7 7 0 0 0 7 7c1.04 0 2.06-.24 3-.68c.94.44 1.96.68 3 .68a7 7 0 0 0 7-7a7 7 0 0 0-7-7c-1.04 0-2.06.24-3 .68c-.94-.44-1.96-.68-3-.68m0 2c.34 0 .67.03 1 .1c-1.28 1.31-2 3.07-2 4.9s.72 3.59 2 4.89c-.33.07-.66.11-1 .11a5 5 0 0 1-5-5a5 5 0 0 1 5-5m6 0a5 5 0 0 1 5 5a5 5 0 0 1-5 5c-.34 0-.67-.03-1-.1c1.28-1.31 2-3.07 2-4.9s-.72-3.59-2-4.89c.33-.07.66-.11 1-.11m-3 1c1.26.95 2 2.43 2 4s-.74 3.05-2 4a5.01 5.01 0 0 1-2-4c0-1.57.74-3.05 2-4"></path></svg>');function Xr(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=Qr();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var Zr=b('<svg><path fill="currentColor" d="M19 10H5V8h14zm0 6H5v-2h14z"></path></svg>');function eo(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=Zr();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var to=b('<svg><path fill="currentColor" d="M3 5h6v6H3zm2 2v2h2V7zm6 0h10v2H11zm0 8h10v2H11zm-6 5l-3.5-3.5l1.41-1.41L5 17.17l4.59-4.58L11 14z"></path></svg>');function ro(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=to();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var oo=b('<svg><path fill="currentColor" d="M16 16.92c-.33.05-.66.08-1 .08s-.67-.03-1-.08v-3.51l-2.5 2.48c-.5-.39-1-.89-1.39-1.39l2.48-2.5H9.08c-.05-.33-.08-.66-.08-1s.03-.67.08-1h3.51l-2.48-2.5c.19-.25.39-.5.65-.74c.24-.26.49-.46.74-.65L14 8.59V5.08c.33-.05.66-.08 1-.08s.67.03 1 .08v3.51l2.5-2.48c.5.39 1 .89 1.39 1.39L17.41 10h3.51c.05.33.08.66.08 1s-.03.67-.08 1h-3.51l2.48 2.5c-.19.25-.39.5-.65.74c-.24.26-.49.46-.74.65L16 13.41zM5 19a2 2 0 0 1 2-2a2 2 0 0 1 2 2a2 2 0 0 1-2 2a2 2 0 0 1-2-2"></path></svg>');function so(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=oo();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var no=b('<svg><path fill="currentColor" d="M9 11h6V8l4 4l-4 4v-3H9v3l-4-4l4-4zm-7 9V4h2v16zm18 0V4h2v16z"></path></svg>');function ao(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=no();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var io=b('<svg><path fill="currentColor" d="M13 20V4h2.03v16zm-3 0V4h2.03v16zM5 8l4.03 4L5 16v-3H2v-2h3zm15 8l-4-4l4-4v3h3v2h-3z"></path></svg>');function lo(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=io();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var co=b('<svg><path fill="currentColor" d="m18.5 4.14l1 1.72L8.97 12l10.53 6.14l-1 1.72L5 12z"></path></svg>');function vo(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=co();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var fo=b('<svg><path fill="currentColor" d="M18.5 2.27L5 10.14L18.5 18l1-1.73l-10.53-6.13L19.5 4zM5 20v2h15v-2z"></path></svg>');function ho(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=fo();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var uo=b('<svg><path fill="currentColor" d="m5.5 4.14l-1 1.72L15 12L4.5 18.14l1 1.72L19 12z"></path></svg>');function go(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=uo();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var po=b('<svg><path fill="currentColor" d="M6.5 2.27L20 10.14L6.5 18l-1-1.73l10.53-6.13L5.5 4zM20 20v2H5v-2z"></path></svg>');function mo(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=po();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var $o=b('<svg><path fill="currentColor" d="M11 3h2v7.27l6.29-3.63l1 1.73L14 12l6.3 3.64l-1 1.73l-6.3-3.65V21h-2v-7.27l-6.31 3.63l-1-1.73L10 12L3.72 8.36l1-1.73L11 10.26z"></path></svg>');function wo(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=$o();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var _o=b('<svg><path fill="currentColor" d="M2 3h6v2H4v14h4v2H2zm5 14v-2h2v2zm4 0v-2h2v2zm4 0v-2h2v2zm7-14v18h-6v-2h4V5h-4V3z"></path></svg>');function yo(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=_o();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var bo=b('<svg><path fill="currentColor" d="M17 13H7v-2h10m2-8H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2"></path></svg>');function xo(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=bo();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var So=b('<svg><path fill="currentColor" d="M17 13h-4v4h-2v-4H7v-2h4V7h2v4h4m2-8H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2"></path></svg>');function Ao(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=So();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var ko=b('<svg><path fill="currentColor" d="M3 1c-1.11 0-2 .89-2 2v11c0 1.11.89 2 2 2h11c1.11 0 2-.89 2-2V3c0-1.11-.89-2-2-2zm0 2h11v11H3zm15 4v2h2v11H9v-2H7v2c0 1.11.89 2 2 2h11c1.11 0 2-.89 2-2V9c0-1.11-.89-2-2-2z"></path></svg>');function Co(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=ko();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var zo=b('<svg><path fill="currentColor" d="M22 3H5a2 2 0 0 0-2 2v4h2V5h17v14H5v-4H3v4a2 2 0 0 0 2 2h17a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2M7 15v-2H0v-2h7V9l4 3zm13-2h-7v-2h7zm0-4h-7V7h7zm-3 8h-4v-2h4z"></path></svg>');function Mo(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=zo();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var Do=b('<svg><path fill="currentColor" d="M3 3h6v4H3zm12 7h6v4h-6zm0 7h6v4h-6zm-2-4H7v5h6v2H5V9h2v2h6z"></path></svg>');function Bo(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=Do();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var To=b('<svg><path fill="currentColor" d="M6.45 17.45L1 12l5.45-5.45l1.41 1.41L4.83 11h14.34l-3.03-3.04l1.41-1.41L23 12l-5.45 5.45l-1.41-1.41L19.17 13H4.83l3.03 3.04z"></path></svg>');function Ho(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=To();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var Oo=b('<svg><path fill="currentColor" d="m18.5 4l1.16 4.35l-.96.26c-.45-.87-.91-1.74-1.44-2.18C16.73 6 16.11 6 15.5 6H13v10.5c0 .5 0 1 .33 1.25c.34.25 1 .25 1.67.25v1H9v-1c.67 0 1.33 0 1.67-.25c.33-.25.33-.75.33-1.25V6H8.5c-.61 0-1.23 0-1.76.43c-.53.44-.99 1.31-1.44 2.18l-.96-.26L5.5 4z"></path></svg>');function Po(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=Oo();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var Vo=b('<svg><path fill="currentColor" d="M3 11h2v2H3zm8-6h2v4h-2zm-2 6h4v4h-2v-2H9zm6 0h2v2h2v-2h2v2h-2v2h2v4h-2v2h-2v-2h-4v2h-2v-4h4v-2h2v-2h-2zm4 8v-4h-2v4zM15 3h6v6h-6zm2 2v2h2V5zM3 3h6v6H3zm2 2v2h2V5zM3 15h6v6H3zm2 2v2h2v-2z"></path></svg>');function Eo(s,e){const t=$(e,["$$slots","$$events","$$legacy"]);var r=Vo();y(r,()=>({viewBox:"0 0 24 24",width:"1.2em",height:"1.2em",...t})),f(s,r)}var No=P('<div><!> <span class="text-sm font-medium text-foreground"> </span></div>');function Lo(s,e){N(e,!0);const r=Q().createDraggable({unmount:wt,get node(){return e.createNode()}});var n=No(),l=O(n);re(l,()=>e.icon);var a=R(l,2),d=O(a,!0);B(a),B(n),_t(n,()=>r.attach),Ne(()=>{Se(n,1,Ae(["flex items-center gap-2 p-2 rounded-md cursor-grab border hover:bg-accent",r.isDragged&&"bg-accent"])),Le(d,e.title)}),f(s,n),L()}var Io=P('<div class="flex flex-col gap-2"></div>');function jo(s,e){N(e,!0);const t={[H.Object]:kr,[H.ObjectProperty]:null,[H.ObjectPropertyDependency]:null,[H.Predicate]:null,[H.Operator]:null,[H.Array]:Dr,[H.Grid]:zr,[H.Enum]:Tr,[H.MultiEnum]:Or,[H.EnumItem]:null,[H.String]:Vr,[H.Number]:Nr,[H.Boolean]:Ir,[H.File]:Rr,[H.Tags]:Ur,[H.Range]:Ho,[H.QrCode]:Eo},r={[z.And]:Gr,[z.Or]:Kr,[z.Xor]:Jr,[z.Not]:Xr,[z.Eq]:eo,[z.In]:ro,[z.Format]:Po,[z.Pattern]:so,[z.MinLength]:lo,[z.MaxLength]:ao,[z.Less]:vo,[z.LessOrEq]:ho,[z.Greater]:go,[z.GreaterOrEq]:mo,[z.MultipleOf]:wo,[z.Contains]:yo,[z.MinItems]:xo,[z.MaxItems]:Ao,[z.UniqueItems]:Co,[z.HasProperty]:Mo,[z.Property]:Bo},n=Q(),l=k(()=>{if(n.selectedNode?.type===H.Predicate){const d=Wt(n.affectedNode??n.selectedNode);return Kt.filter(c=>d.has(c)).map(c=>({id:`op::${c}`,factory:()=>Jt(c),title:Yt[c],nodeType:H.Operator,operatorType:c}))}return n.availableCustomizableNodeTypes.map(d=>({id:`node::${d}`,factory:()=>Xt(d),title:Qt[d],nodeType:d}))});var a=Io();yt(a,21,()=>p(l),({id:d,factory:c,title:g,nodeType:x,operatorType:w})=>d,(d,c)=>{let g=()=>p(c).factory,x=()=>p(c).title,w=()=>p(c).nodeType,h=()=>p(c).operatorType;Lo(d,{get createNode(){return g()},get title(){return x()},icon:o=>{const i=k(()=>h()?r[h()]:t[w()]);var u=j(),m=V(u);E(m,()=>p(i),(I,C)=>{C(I,{class:"shrink-0"})}),f(o,u)},$$slots:{icon:!0}})}),B(a),f(s,a),L()}function Ro(s,e,t,r){function n(h,v,o){const{properties:i,additionalProperties:u,patternProperties:m,propertyNames:I}=h;function C(S,D,A){const T=w(D,A,o[S]);T!==void 0&&(o[S]=T)}if(i!==void 0)for(const[S,D]of Object.entries(i))C(S,D,v[S]);let M;if(m!==void 0){M=[];const S=Object.entries(m).map(([A,T])=>[new RegExp(A),T]),D=new Set(te(h,t));for(const[A,T]of Object.entries(v)){if(D.has(A))continue;const W=S.find(U=>U[0].test(A));if(W===void 0){M.push(A);continue}C(A,W[1],T)}}if(u!==void 0&&u!==!1)if(M!==void 0)for(const S of M)C(S,u,v[S]);else{const S=new Set(te(h,t));for(const[D,A]of Object.entries(v))S.has(D)||C(D,u,A)}if(I!==void 0)for(const[S,D]of Object.entries(v))o[S]=D;return o}function l(h,v,o){const{items:i,additionalItems:u}=h;if(i!==void 0)if(Array.isArray(i))for(let m=0;m<i.length;m++)o.push(w(i[m],v[m]));else for(let m=0;m<v.length;m++)o.push(w(i,v[m]));if(u)for(let m=o.length;m<v.length;m++)o.push(w(u,v[m]));return o}function a(h,v,o){const{if:i,then:u,else:m}=h;if(i===void 0)return o;const C=(Z(i)?s.isValid(i,t,v):i)?u:m;return C===void 0?o:w(C,v,o)}function d(h,v,o,i){if(!Array.isArray(h)||St(s,e,v,t))return i;const u=At(s,e,t,o,h.map(m=>Z(m)?m:m?{}:{not:{}}),0,kt(v));return w(h[u],o,i)}function c(h,v,o){if(!Array.isArray(h))return o;for(let i=0;i<h.length;i++)o=w(h[i],v,o);return o}function g(h,v,o){const{anyOf:i}=h;return Array.isArray(i)?v===void 0||xt(v)&&(Array.isArray(v)?v.length===0:Object.keys(v).length===0)?c(i,v,o):d(i,h,v,o):o}function x(h,v,o){const{dependencies:i}=h;if(i===void 0||!ge(v))return o;for(const[u,m]of Object.entries(i))!(u in v)||Array.isArray(m)||(o=w(m,v,o));return o}function w(h,v,o){if(v===void 0||h===!1)return v;if(h===!0)return o;const{$ref:i}=h;if(i!==void 0)return w(Pe(i,t),v,o);o=g(h,v,c(h.allOf,v,d(h.oneOf,h,v,o)));const u=bt(h);if(u==="object"){if(!ge(v))return;o=n(h,v,ge(o)?o:{})}else if(u==="array"){if(!De(v))return;o=l(h,v,De(o)?o:[])}else o===void 0&&(o=v);return x(h,v,a(h,v,o))}return w(t,r)}function Fo(s,e){N(e,!0);let t=F(e,"node",15);const r=Q(),n=k(()=>r.nodeSchema(t())),l=k(()=>r.nodeUiSchema(t())),a=jt({...Rt,validator:d=>{const c=Ft(d);return{...c,validateFormValue(g,x){const w=Ro(c,d.merger(),d.schema,x);return c.validateFormValue(g,w)}}},get initialValue(){return Mt(()=>Dt(t().options))},get schema(){return p(n)},get uiSchema(){return p(l)},fieldsValidationMode:Ct|zt,fieldsValidationDebounceMs:200});Bt(a),Tt(()=>{a.fieldsValidation.abort()}),oe(()=>{if(a.fieldsValidation.isProcessed)return;const{value:d}=Ht(a);t(t().options=d,!0)}),Ut(s,{}),L()}var Uo=P("<div>Field options will appear here</div>");function qo(s,e){N(e,!0);const t=Q(),r=k(()=>t.selectedNode);var n=j(),l=V(n);{var a=g=>{Zt(g,{class:"p-3 border-blue-600",children:(x,w)=>{var h=()=>p(r),v=o=>t.updateSelectedNode(o);Fo(x,{get node(){return h()},set node(o){v(o)}})},$$slots:{default:!0}})},d=k(()=>p(r)&&er(p(r))),c=g=>{var x=Uo();Se(x,1,Ae(["flex h-full flex-col items-center justify-center","rounded-md bg-gray-100 p-4 text-center text-sm text-muted-foreground"])),f(g,x)};le(l,g=>{p(d)?g(a):g(c,!1)})}f(s,n),L()}var Go=P('<div class="flex flex-col gap-2"><div class="rounded-md border border-(--global-border) p-4"><formata-form></formata-form></div></div>',2);function Wo(s,e){N(e,!0);const t=Q(),r=k(()=>t.schema),n=k(()=>t.uiSchema??{}),l=k(()=>p(n)&&!Pt(p(n)));let a=xe(void 0);oe(()=>{p(a)&&(p(a).schema=p(r),p(a).uiSchema=p(l)?p(n):void 0,p(a).darkMode=Ot.isDark,p(a).preventPageReload=!1)});const d=k(()=>JSON.stringify({...p(r),...p(n)}));var c=j(),g=V(c);Ie(g,()=>p(d),x=>{var w=Go(),h=O(w),v=O(h);ee(v,o=>Y(a,o),()=>p(a)),B(h),B(w),f(x,w)}),f(s,c),L()}var Ko=P('<div><div class="sticky top-(--header-height) h-[calc(100vh-var(--header-height))] min-w-[150px] overflow-y-auto"><!></div> <div><!></div> <div class="sticky top-(--header-height) h-[calc(100vh-var(--header-height))] min-w-[200px] overflow-y-auto"><!></div> <div class="overflow-x-hidden"><!></div></div>');function Yo(s,e){N(e,!0),tr(e.ctx);let t=!1;function r(o){e.initialSchema!==void 0&&!t&&(t=!0,o.loadFromSchema(e.initialSchema,e.initialUiSchema)),e.onInit?.(o)}oe(()=>r(e.ctx));let n=Ve(new Array(3));oe(()=>Vt(document,"mousedown",({target:o})=>{o instanceof Node&&n.every(i=>i!==o)&&n.some(i=>i?.contains(o))||setTimeout(()=>{e.ctx.clearSelection()})}));var l=Ko();Se(l,1,Ae(["mx-auto grid gap-6","grid-cols-[1fr_3fr_2fr_3fr]"]));var a=O(l),d=O(a);jo(d,{}),B(a),ee(a,o=>n[0]=o,()=>n?.[0]);var c=R(a,2),g=O(c);Sr(g,{}),B(c),ee(c,o=>n[1]=o,()=>n?.[1]);var x=R(c,2),w=O(x);qo(w,{}),B(x),ee(x,o=>n[2]=o,()=>n?.[2]);var h=R(x,2),v=O(h);Wo(v,{}),B(h),B(l),f(s,l),L()}var Jo=P("<p>Loading...</p>"),Qo=P('<div class="min-h-screen bg-background dark:scheme-dark"><!></div>');function Xo(s,e){N(e,!0);const t=Promise.all([rr]);Et(s,{delayDuration:0,children:(r,n)=>{var l=Qo(),a=O(l);nr(a,()=>t,d=>{var c=Jo();f(d,c)},(d,c)=>{var g=k(()=>{var[h]=p(c);return{highlighter:h}}),x=k(()=>p(g).highlighter);const w=k(()=>new or(p(x)));{let h=k(()=>e.initialData?.schema),v=k(()=>e.initialData?.uiSchema);Yo(d,{get ctx(){return p(w)},get initialSchema(){return p(h)},get initialUiSchema(){return p(v)},get onInit(){return e.onInit}})}}),B(l),f(r,l)},$$slots:{default:!0}}),L()}var Zo=P('<!> <!> <div class="absolute bottom-0 flex w-full justify-end border-t bg-background/40 p-2 backdrop-blur-xl"><!></div>',1),es=P("<!> <!>",1),ts=P("<pre> </pre> <!>",1);function rs(s,e){N(e,!0);let t=F(e,"value",15);const r=Nt();let n=xe(!1),l;const a=k(()=>e.config.path),d=k(()=>e.config.path.toSpliced(-1,1,"uiSchema"));function c(){const i=Te(r),u=me.get(i,p(a)),m=me.get(i,p(d));if(!(!u||typeof u!="object"||!("type"in u)))return{schema:u,uiSchema:m}}function g(){if(!l||!l.validate())return;const i=Te(r);Lt(r,{...typeof i=="object"&&i!==null?i:{},schema:l.schema,uiSchema:l.uiSchema??me.get(i,p(d))}),t(l.schema),Y(n,!1)}function x(i){l=i}var w=ts(),h=V(w),v=O(h);B(h);var o=R(h,2);E(o,()=>mr,(i,u)=>{u(i,{get open(){return p(n)},set open(m){Y(n,m,!0)},children:(m,I)=>{var C=es(),M=V(C);{const D=(A,T)=>{Be(A,J(()=>T?.().props,{onclick:U=>{U.preventDefault(),Y(n,!0)},children:(U,X)=>{ie();var K=pe("Open");f(U,K)},$$slots:{default:!0}}))};E(M,()=>pr,(A,T)=>{T(A,{child:D,$$slots:{child:!0}})})}var S=R(M,2);E(S,()=>gr,(D,A)=>{A(D,{class:"h-[calc(100vh-2rem)] w-[calc(100vw-2rem)] max-w-none! p-4!",style:"--header-height: 7rem",children:(T,W)=>{var U=Zo(),X=V(U);E(X,()=>dr,(G,ke)=>{ke(G,{class:"border-b pb-2",children:(ve,ls)=>{var Ce=j(),Fe=V(Ce);E(Fe,()=>lr,(Ue,qe)=>{qe(Ue,{children:(Ge,cs)=>{ie();var We=pe("Formata Config");f(Ge,We)},$$slots:{default:!0}})}),f(ve,Ce)},$$slots:{default:!0}})});var K=R(X,2);{let G=k(c);Xo(K,{get initialData(){return p(G)},onInit:x})}var de=R(K,2),se=O(de);Be(se,{onclick:g,children:(G,ke)=>{ie();var ve=pe("Save");f(G,ve)},$$slots:{default:!0}}),B(de),f(T,U)},$$slots:{default:!0}})}),f(m,C)},$$slots:{default:!0}})}),Ne(i=>Le(v,`
    ${i??""}
`),[()=>JSON.stringify(c(),null,2)]),f(s,w),L()}function ye(s){const e=s.indexOf(":");return e===-1?{stepId:"",substepId:s}:{stepId:s.slice(0,e),substepId:s.slice(e+1)}}class os{constructor(e){this.config=e}getEntityName(){return"Substep"}getKey(e){return`${e.__stepId}:${e.id}`}getSchema(){return Ee("Substep")}getUiSchema(){return{role:{"ui:components":{textWidget:sr},"ui:options":{attestaConfig:this.config}},uiSchema:{"ui:components":{objectTemplate:Re}},schema:{"ui:components":{objectField:rs}}}}list(){return this.config.workflow.steps.flatMap(e=>e.substeps.map(t=>({...t,__stepId:e.id})))}getOne(e){const{stepId:t,substepId:r}=ye(e),n=this.config.workflow.steps.find(a=>a.id===t);if(!n)return _.err(new Error(`Substep not found: ${e}`));const l=n.substeps.find(a=>a.id===r);return l?_.ok({...l,__stepId:n.id}):_.err(new Error(`Substep not found: ${e}`))}create(e){const t=e.__stepId,r=this.config.workflow.steps.find(a=>a.id===t);if(!r)return _.err(new Error(`Step not found: ${t}`));if(r.substeps.some(a=>a.id===e.id))return _.err(new Error(`Substep already exists: ${e.id}`));const{__stepId:n,...l}=e;return r.substeps=[...r.substeps,l].sort((a,d)=>a.order-d.order),_.ok(e)}update(e,t){const{stepId:r,substepId:n}=ye(e),l=this.config.workflow.steps.find(g=>g.id===r);if(!l)return _.err(new Error(`Substep not found: ${e}`));if(l.substeps.findIndex(g=>g.id===n)===-1)return _.err(new Error(`Substep not found: ${e}`));const{__stepId:d,...c}=t;return l.substeps=l.substeps.map(g=>g.id===n?c:g),_.ok(t)}delete(e){const{stepId:t,substepId:r}=ye(e),n=this.config.workflow.steps.find(a=>a.id===t);return n?n.substeps.findIndex(a=>a.id===r)===-1?_.err(new Error(`Substep not found: ${e}`)):(n.substeps=n.substeps.filter(a=>a.id!==r),_.ok(void 0)):_.err(new Error(`Substep not found: ${e}`))}moveUp(e,t){if(t<=0)return _.ok(void 0);const r=this.config.workflow.steps.find(d=>d.id===e);if(!r)return _.err(new Error(`Step not found: ${e}`));const n=r.substeps;if(t>=n.length)return _.ok(void 0);const l=n[t],a=n[t-1];return!l||!a?_.ok(void 0):(r.substeps=n.map((d,c)=>c===t?{...a,order:t}:c===t-1?{...l,order:t-1}:d),_.ok(void 0))}moveDown(e,t){const r=this.config.workflow.steps.find(d=>d.id===e);if(!r)return _.err(new Error(`Step not found: ${e}`));const n=r.substeps;if(t>=n.length-1)return _.ok(void 0);const l=n[t],a=n[t+1];return!l||!a?_.ok(void 0):(r.substeps=n.map((d,c)=>c===t?{...a,order:t}:c===t+1?{...l,order:t+1}:d),_.ok(void 0))}}var ss=P("<div><!></div>"),ns=P("<div><!></div>"),as=P('<div><p class="flex items-center justify-center text-sm text-muted-foreground">Select a step or substep in the tree, or use the add buttons to create one.</p></div>'),is=P('<div class="flex grow justify-stretch"><div class="w-[400px] overflow-auto border-r p-2"><!></div> <div class="min-w-0 grow p-4"><!></div></div>');function us(s,e){N(e,!0);function t(o){return o.workflow.steps.map(i=>({type:"branch",label:i.title,key:i.id,children:i.substeps.map(u=>({type:"leaf",label:u.title,key:`${i.id}-${u.id}`}))}))}const r=new xr(q),n=new os(q),l=new He(r),a=new He(n),d=new br(()=>t(q),{maxBranchDepth:1,addTypesByDepth:{0:["branch"],1:["leaf"]},onMoveUp(o){if(o.length===1)r.moveUp(o[0]);else if(o.length===2){const i=q.workflow.steps[o[0]];i&&n.moveUp(i.id,o[1])}},onMoveDown(o){if(o.length===1)r.moveDown(o[0]);else if(o.length===2){const i=q.workflow.steps[o[0]];i&&n.moveDown(i.id,o[1])}},onDelete(o){if(o.length===1){const i=q.workflow.steps[o[0]];i&&l.openDelete(i)}else if(o.length===2){const i=q.workflow.steps[o[0]],u=i?.substeps[o[1]];i&&u&&a.openDelete({...u,__stepId:i.id})}},onAddBranch(){},onAddLeaf(){}});oe(()=>{const o=d.selection,i=q.workflow.steps;if(o.state==="selected"){if(o.path.length===1){const u=i[o.path[0]];u&&l.openEdit(u)}else if(o.path.length===2){const u=i[o.path[0]],m=u?.substeps[o.path[1]];u&&m&&a.openEdit({...m,__stepId:u.id})}}else if(o.state==="adding")if(o.type==="branch"){const u=o.path.length===1&&o.path[0]===-1?i.length:o.path.length>0?o.path[0]+1:0,m={id:crypto.randomUUID(),title:"New step",order:u,substeps:[]};l.openCreateWithCallback(m,I=>{const C=r.createAt(I,u);C.isOk?(ae.success("Record created"),l.isFormOpen=!1,d.clearSelection()):ae.error(C.error.message)})}else{const u=i[o.path[0]];if(!u)return;const m={__stepId:u.id,id:crypto.randomUUID(),title:"New substep",order:u.substeps.length,role:"",inputKey:"",inputType:"string"};a.openCreateWithCallback(m,I=>{const C=n.create(I);C.isOk?(ae.success("Record created"),a.isFormOpen=!1,d.clearSelection()):ae.error(C.error.message)})}}),It({title:"Workflow"});const c=k(()=>{const o=d.selection;return o.state==="idle"?null:o.state==="selected"?o.path.length===1?"step":"substep":o.type==="branch"?"step":"substep"});var g=is(),x=O(g),w=O(x);E(w,()=>d.Tree,(o,i)=>{i(o,{get self(){return d}})}),B(x);var h=R(x,2),v=O(h);Ie(v,()=>d.selection,o=>{var i=j(),u=V(i);{var m=M=>{var S=ss(),D=O(S);E(D,()=>l.Forms,(A,T)=>{T(A,{get self(){return l},formTitle:"step",onConfirmDelete:()=>d.clearSelection(),hideSubmitButton:!0})}),B(S),$e(3,S,()=>we),f(M,S)},I=M=>{var S=ns(),D=O(S);E(D,()=>a.Forms,(A,T)=>{T(A,{get self(){return a},formTitle:"substep",onConfirmDelete:()=>d.clearSelection(),hideSubmitButton:!0})}),B(S),$e(3,S,()=>we),f(M,S)},C=M=>{var S=as();$e(3,S,()=>we),f(M,S)};le(u,M=>{p(c)==="step"?M(m):p(c)==="substep"?M(I,1):M(C,!1)})}f(o,i)}),B(h),B(g),f(s,g),L()}export{us as default};
